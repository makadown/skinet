(self.webpackChunkclient=self.webpackChunkclient||[]).push([[422],{3422:(t,e,r)=>{"use strict";r.r(e),r.d(e,{AccountModule:()=>J});var n=r(1116),i=r(8709),o=r(1462),s=r(7368),a=r(3230),l=r(3722);function u(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"form",1),s.NdJ("ngSubmit",function(){return s.CHM(t),s.oxw().onSubmit()}),s._UZ(1,"app-text-input",2),s._UZ(2,"app-text-input",3),s.TgZ(3,"button",4),s._uU(4,"Sign in"),s.qZA(),s.TgZ(5,"p",5),s._uU(6),s.ALo(7,"date"),s.qZA(),s.qZA()}if(2&t){const t=s.oxw();s.Q6J("formGroup",t.loginForm),s.xp6(1),s.Q6J("label","Email Address"),s.xp6(1),s.Q6J("label","Password")("type","password"),s.xp6(1),s.Q6J("disabled",t.loginForm.invalid),s.xp6(3),s.hij("\xa9 2020 - ",s.xi3(7,6,t.today,"yyyy"),"")}}let c=(()=>{class t{constructor(t,e,r){this.accountService=t,this.router=e,this.activatedRoute=r,this.today=new Date,this.returnUrl="",this.returnUrl=this.activatedRoute.snapshot.queryParams.returnUrl||"/shop",this.today=new Date}ngOnInit(){this.loadCurrentUser()}createLoginForm(){this.loginForm=new o.cw({email:new o.NI("",[o.kI.required,o.kI.pattern("^([a-zA-Z0-9_\\-\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([a-zA-Z0-9\\-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\\]?)$")]),password:new o.NI("",o.kI.required)})}onSubmit(){this.accountService.login(this.loginForm.value).subscribe(()=>{this.router.navigateByUrl(this.returnUrl)},console.log)}loadCurrentUser(){const t=localStorage.getItem("token");t?this.accountService.loadCurrentUser(t).subscribe(()=>{this.router.navigateByUrl(this.returnUrl)},t=>{console.error(t),this.createLoginForm()}):this.createLoginForm()}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(a.B),s.Y36(i.F0),s.Y36(i.gz))},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-login"]],decls:1,vars:1,consts:[["class","form-signin",3,"formGroup","ngSubmit",4,"ngIf"],[1,"form-signin",3,"formGroup","ngSubmit"],["formControlName","email",3,"label"],["formControlName","password",3,"label","type"],["type","submit",1,"btn","btn-lg","btn-primary","btn-block",3,"disabled"],[1,"mt-5","mb-3","text-muted","text-center"]],template:function(t,e){1&t&&s.YNc(0,u,8,9,"form",0),2&t&&s.Q6J("ngIf",e.loginForm)},directives:[n.O5,o._Y,o.JL,o.sg,l.t,o.JJ,o.u],pipes:[n.uU],styles:[".form-signin[_ngcontent-%COMP%], .form-status[_ngcontent-%COMP%]{width:100%;max-width:420px;padding:15px;margin:auto}"]}),t})();var p=r(8318),m=r(8569),d=r(8470);function g(t){return!(0,d.k)(t)&&t-parseFloat(t)+1>=0}var h=r(6163);function b(t){const{index:e,period:r,subscriber:n}=t;if(n.next(e),!n.closed){if(-1===r)return n.complete();t.index=e+1,this.schedule(t,r)}}var f=r(878),y=r(4689),x=r(9996);function v(t,e){if(1&t&&(s.TgZ(0,"li"),s._uU(1),s.qZA()),2&t){const t=e.$implicit;s.xp6(1),s.hij(" ",t," ")}}function Z(t,e){if(1&t&&(s.TgZ(0,"ul",9),s.YNc(1,v,2,1,"li",10),s.qZA()),2&t){const t=s.oxw();s.xp6(1),s.Q6J("ngForOf",t.errors)}}const w=[{path:"login",component:c},{path:"register",component:(()=>{class t{constructor(t,e,r){this.fb=t,this.accountService=e,this.router=r,this.errors=[],this.today=new Date,this.errors=[],this.today=new Date}ngOnInit(){this.loadCurrentUser()}loadCurrentUser(){const t=localStorage.getItem("token");t?this.accountService.loadCurrentUser(t).subscribe(()=>{this.router.navigateByUrl("/shop")},console.error):this.createRegisterForm()}createRegisterForm(){this.registerForm=this.fb.group({displayName:[null,[o.kI.required]],email:[null,[o.kI.required,o.kI.pattern("^([a-zA-Z0-9_\\-\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([a-zA-Z0-9\\-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\\]?)$")],[this.validateEmailNotTaken()]],password:[null,[o.kI.required]]})}onSubmit(){this.errors=[],this.accountService.register(this.registerForm.value).subscribe(t=>{this.router.navigateByUrl("/shop")},t=>{console.error(t),Array.isArray(t)&&this.generateErrorMessages(t)})}generateErrorMessages(t){t.forEach(t=>{"string"==typeof t&&this.errors.push(t)})}validateEmailNotTaken(){return t=>function(t=0,e,r){let n=-1;return g(e)?n=Number(e)<1?1:Number(e):(0,h.K)(e)&&(r=e),(0,h.K)(r)||(r=m.P),new p.y(e=>{const i=g(t)?t:+t-r.now();return r.schedule(b,i,{index:0,period:n,subscriber:e})})}(500).pipe((0,y.w)(()=>t.value?this.accountService.checkEmailExists(t.value).pipe((0,x.U)(t=>t?{emailExists:!0}:null)):(0,f.of)(null)))}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(o.qu),s.Y36(a.B),s.Y36(i.F0))},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-register"]],decls:12,vars:11,consts:[[1,"d-flex","justify-content-center"],[1,"col-3"],[3,"formGroup","ngSubmit"],["formControlName","displayName",3,"label"],["formControlName","email",3,"label"],["formControlName","password",3,"label","type"],["class","text-danger list-unstyled",4,"ngIf"],["type","submit",1,"btn","btn-lg","btn-primary","btn-block",3,"disabled"],[1,"mt-5","mb-3","text-muted","text-center"],[1,"text-danger","list-unstyled"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(s.TgZ(0,"div",0),s.TgZ(1,"div",1),s.TgZ(2,"form",2),s.NdJ("ngSubmit",function(){return e.onSubmit()}),s._UZ(3,"app-text-input",3),s._UZ(4,"app-text-input",4),s._UZ(5,"app-text-input",5),s.YNc(6,Z,2,1,"ul",6),s.TgZ(7,"button",7),s._uU(8,"Sign in"),s.qZA(),s.TgZ(9,"p",8),s._uU(10),s.ALo(11,"date"),s.qZA(),s.qZA(),s.qZA(),s.qZA()),2&t&&(s.xp6(2),s.Q6J("formGroup",e.registerForm),s.xp6(1),s.Q6J("label","Display Name"),s.xp6(1),s.Q6J("label","Email Address"),s.xp6(1),s.Q6J("label","Password")("type","password"),s.xp6(1),s.Q6J("ngIf",e.errors.length>0),s.xp6(1),s.Q6J("disabled",e.registerForm.invalid),s.xp6(3),s.hij("\xa9 2020 - ",s.xi3(11,8,e.today,"yyyy"),""))},directives:[o._Y,o.JL,o.sg,l.t,o.JJ,o.u,n.O5,n.sg],pipes:[n.uU],styles:[""]}),t})()}];let U=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[i.Bz.forChild(w)],i.Bz]}),t})();var A=r(5425);let J=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[n.ez,U,A.m]]}),t})()}}]);